<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weekly Me</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />

  <link rel="stylesheet" href="HTML_Project/css/card.css" />
  <link rel="stylesheet" href="HTML_Project/css/category.css" />
  <link rel="stylesheet" href="HTML_Project/css/KYG_comment.css" />
  <link rel="stylesheet" href="HTML_Project/css/login.css" />
  <link rel="stylesheet" href="HTML_Project/css/sideUI.css" />
  <link rel="stylesheet" href="HTML_Project/css/afterLogin.css" />

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR");

    * {
      font-family: "Noto Sans KR", sans-serif;
    }

    .nav-link,
    .shine-text,
    .introsub_text {
      font-family: "Black Han Sans", sans-serif;
    }

    /*ë°°ê²½ì„¤ì •*/
    body {
      height: 5000px;
      background-image: url('HTML_Project/picture/mainBackground.jpeg');
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;
      background-blend-mode: overlay;
      background-color: rgba(0, 0, 255, 0.1);
    }

    /*ì¹´í…Œê³ ë¦¬ í°íŠ¸*/
    .nav-link {
      font-size: 3rem;
      color: white;
    }

    /*ë‚´ë¹„ê²Œì´ì…˜ ìƒë‹¨ê³ ì •*/
    .fixed-nav {
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 100;
    }

    /*íŒ€ì†Œê°œ ë°°ê²½*/
    .intro {
      margin-top: 200px;
      padding-top: 50px;
      padding-bottom: 50px;
      background-color: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-right: 100px;
      padding-left: 50px;

    }

    /*íŒ€ì†Œê°œ í…ìŠ¤íŠ¸*/
    .introText {
      align-items: center;
    }

    /*ì´ë¯¸ì§€ í¬ê¸° ë° ì˜¤ë¥¸ìª½ì •ë ¬*/
    .intro img {
      width: 100%;
      max-width: 600px;
      height: auto;
      border-radius: 40%;
      margin: 0 auto;
      display: block;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      transition: transform 0.3s ease, filter 0.3s ease;
      border: 5px solid rgba(204, 196, 196, 0.212);
      filter: grayscale(10%)
    }

    .intro img:hover {
      transform: scale(1.03);
      filter: brightness(1.05);
    }


    /*í…ìŠ¤íŠ¸ í°íŠ¸*/
    .intro p {
      color: white;
      font-size: 2rem;
    }

    /*íŒ€ì› ì¹´ë“œ ë°°ê²½*/
    .team {
      margin-top: 600px;
      padding-top: 50px;
      padding-bottom: 50px;
      background-color: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-right: 100px;
      padding-left: 50px;
    }

    /*ëŒ“ê¸€ ì°½ì°½*/
    .comment__box {
      background-color: rgba(0, 0, 0, 0.6);
      color: white;
    }

    .comment_text {
      font-weight: 900;
    }

    /*ë©˜íŠ¸ ë°•ìŠ¤*/
    .speakingbox {
      padding: 6rem;
      margin: 12rem auto 12rem auto;
      border-radius: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      max-width: 1000px;
      text-align: center;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      -webkit-backdrop-filter: blur(10px);
    }

    .quote-text {
      font-size: 2.3rem;
      font-weight: 600;
      color: #fff;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .quote-author {
      margin-top: 1.5rem;
      font-size: 1rem;
      color: #000000;
      font-style: italic;
    }

    /* í”Œë¡œíŒ… ë²„íŠ¼ */
    .floating-ui {
      position: fixed;
      top: 200px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      background-color: transparent;
      border: none;
    }

    /* ë¡œê·¸ì¸ ë²„íŠ¼ */
    #loginButton {
      padding: 10px 20px;
      font-size: 1rem;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    /* íšŒì›ê°€ì… ë²„íŠ¼ */
    #registerButton {
      padding: 10px 20px;
      font-size: 1rem;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    /* ë²„íŠ¼ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ íš¨ê³¼ */
    #loginButton:hover {
      background-color: #0056b3;
    }

    #registerButton:hover {
      background-color: #218838;
    }

    .pageLink {
      text-align: center;
      color:white
    }

    .pageBtn {
      all:unset;
    }
  </style>
</head>

<body>
  <!--ì¹´í…Œê³ ë¦¬ ìˆ˜ì§ì •ë ¬ ë‚´ë¹„ê²Œì´ì…˜íƒ­ ë¶€íŠ¸ìŠ¤íŠ¸ë© ì‚¬ìš©-->
  <!--hrefì— í´ë¦­ì‹œ ì´ë™ ìœ„ì¹˜ ì¶”ê°€ -ì´í˜„í•˜-->
  <ul class="nav justify-content-center fixed-nav">
    <li class="nav-item">
      <a class="nav-link" aria-current="page" href="#teamIntro">íŒ€ ì†Œê°œ</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#teamMember">íŒ€ì›ë“¤</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#todayMent">ë°©ëª…ë¡</a>
    </li>

    <div class="loginName" id="loginName">
      <p id="loginNameText">aaa</p>
      <button id="logoutButton" class="logoutButton">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </ul>


  <!--id ì¶”ê°€ ë° íŒ€ ì†Œê°œ ë³€ê²½ -ì´í˜„í•˜-->
  <div class="intro" id="teamIntro">
    <div class="introText">
      <h1><span class="shine-text">Weekly Me</span> ğŸ‘‘</h1>
      <p class="introsub_text">â€œì´ë²ˆ ì£¼ì˜ ì£¼ì¸ê³µì€ ëˆ„êµ¬?â€ <br>
        ë°”ë¡œ ì €í¬ Weekly Me, 1ì¡°ì…ë‹ˆë‹¤! <br>
      </p>
      <p style="font-size: 1.5rem;">ì´ë¦„ì²˜ëŸ¼ ì´ë²ˆ ì£¼ì˜ ì£¼ì¸ê³µ(ì¼ì£¼ì¸ê³µ)ì€ ë°”ë¡œ ìš°ë¦¬ì´ê³ ,<br>
        ë§¤ì£¼ ë” ì„±ì¥í•˜ëŠ” ë‚˜ë¥¼ ë§Œë“¤ì–´ê°€ìëŠ” ì˜ë¯¸ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.<br>
        ì§§ì§€ë§Œ ê°ìì˜ ê°•ì ì„ ì‚´ë ¤ í˜‘ë ¥í•˜ê³ , ì¦ê¸°ë©´ì„œ ì„±ì¥í•˜ëŠ” íŒ€ì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤!ğŸ”¥
      </p>
    </div>
    <img src="HTML_Project\picture\teamImg.jpg">
  </div>

  <!--ì¹´ë“œ ìš°ìƒˆë¹›-->
  <!--íŒ€ì› ìš”ì•½ ê·¸ë¦¬ë“œì¹´ë“œ ë¶€íŠ¸ìŠ¤íŠ¸ë© ì‚¬ìš©ìš©-->
  <!--card.jsë¥¼ í†µí•´ í•´ë‹¹ í˜ì´ì§€ë¡œ ì´ë™-->
  <div class="team" id="teamMember">
    <div class="row row-cols-1 row-cols-md-3 g-4">
      <div class="col">
        <div class="card" id="card_LJY">
          <img src="HTML_Project/picture/LJY/LJY_Picture.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title"><b>ì´ì¤€ì˜</b></h5>
            <p class="card-text">íŒ€ì¥</p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card" id="card_hyeonha">
          <img src="HTML_Project/picture/LHH/LHH_image.jpeg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title"><b>ì´í˜„í•˜</b></h5>
            <p class="card-text">íŒ€ì›</p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card" id="card_WSV">
          <img src="HTML_Project/picture/WSV/WSV_p.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title"><b>ìš°ìƒˆë¹›</b></h5>
            <p class="card-text">íŒ€ì›</p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card" id="card_CHE">
          <img src="HTML_Project/picture/CHE/CHE_face.jpg" class="card-img-top">
          <div class="card-body">
            <h5 class="card-title"><b>ìµœê²½ì§„</b></h5>
            <p class="card-text">íŒ€ì›</p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card" id="card_HJ">
          <img src="HTML_Project/picture/HJ/YHJ.png.png" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title"><b>ìœ¤í¬ì¤€</b></h5>
            <p class="card-text">íŒ€ì›</p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card" id="card_KYG">
          <img src="HTML_Project/picture/KYG/KYG_face.png" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title"><b>ê¹€ìš©ì¤€</b></h5>
            <p class="card-text">íŒ€ì›</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ë©˜íŠ¸ ë°•ìŠ¤ -->
  <div class="speakingbox" id="todayMent">
    <h3>ğŸ“Œ ì˜¤ëŠ˜ì˜ íŒ€ ë©˜íŠ¸</h3>
    <p id="team-quote" class="quote-text"></p>
    <p id="team-author" class="quote-author"></p>
  </div>


  <!--ëŒ“ê¸€ ê¹€ìš©ì¤€-->
  <div class="comment__box" id="homeComment">
    <h1 class="comment_text">ë°©ëª…ë¡</h1>
    <div class="input-group">
      <input type="text" class="form-control" placeholder="Recipient's username" aria-label="Recipient's username"
        aria-describedby="button-addon2" id="homeCommentText" />
      <button type="button" class="btn btn-primary" id="postingComment">ê²Œì‹œ</button>
    </div>
  </div>
  <div class="comment__panel"></div>
  <div class="pageLink"></div>


  <!--ë¡œê·¸ì¸íšŒì›ê°€ì…UI-->
  <div class="floating-ui" id="floatingUI" style="display: none;">
    <button id="loginButton">ë¡œê·¸ì¸</button>
    <button id="registerButton">íšŒì›ê°€ì…</button>
  </div>

  <!--ë¡œê·¸ì¸ íŒì—…-->
  <!--formì‚¬ìš©-->
  <div id="loginPopup" class="popup">
    <div class="popup-content">
      <span class="close-button" id="closeLoginPopup">&times;</span>
      <h2>ë¡œê·¸ì¸</h2>
      <form>
        <div class="mb-3">
          <label for="loginID" class="form-label">ì•„ì´ë””</label>
          <input type="text" class="form-control" id="loginID" aria-describedby="emailHelp">
        </div>
        <div class="mb-3">
          <label for="loginPW" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" class="form-control" id="loginPW">
        </div>
        <button type="button" class="btn btn-primary" id="login">ë¡œê·¸ì¸</button>
      </form>
    </div>
  </div>

  <!--íšŒì›ê°€ì… íŒì—…-->
  <!--formì‚¬ìš©-->
  <div id="registerPopup" class="popup">
    <div class="popup-content">
      <span class="close-button" id="closeRegisterPopup">&times;</span>
      <h2>íšŒì›ê°€ì…</h2>
      <form>
        <div class="mb-3">
          <label for="regName" class="form-label">ë‹‰ë„¤ì„</label>
          <input type="text" class="form-control" id="regName">
        </div>
        <div class="mb-3">
          <label for="registerId" class="form-label">ì•„ì´ë””</label>
          <input type="text" class="form-control" id="registerId">
        </div>
        <div class="mb-3">
          <label for="registerPassword" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" class="form-control" id="registerPassword">
        </div>
        <div class="mb-3">
          <label for="registerPasswordConfirm" class="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <input type="password" class="form-control" id="registerPasswordConfirm">
        </div>
        <button type="button" class="btn btn-success" id="register">íšŒì›ê°€ì…</button>
      </form>
    </div>
  </div>
  </div>

  <script src="HTML_Project/javaScript/card.js">/*ì¹´ë“œ ì´ë²¤íŠ¸*/</script>
  <script src="HTML_Project/javaScript/register_login.js">/*ë¡œê·¸ì¸, íšŒì›ê°€ì…ì… íŒì—…*/</script>
  <script src="HTML_Project/javaScript/todayMent.js">/*ë©˜íŠ¸ê¸°ëŠ¥*/</script>
  <script type="module">/* íŒŒì´ì–´ë² ì´ìŠ¤ */
    // ë¡œê·¸ì¸, íšŒì›ê°€ì…, ëŒ“ê¸€ ë“±ì˜ ê¸°ëŠ¥

    // Firebase SDK ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import {
      getFirestore,
      doc,
      deleteDoc,
      startAt,
      limit,
      getCountFromServer,
      collection,
      addDoc,
      getDocs,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyDIYr5xaD01ndxx0anOhCgoKRHT6rAHWnc",
      authDomain: "weeklyme-4e92d.firebaseapp.com",
      projectId: "weeklyme-4e92d",
      storageBucket: "weeklyme-4e92d.firebasestorage.app",
      messagingSenderId: "499565676750",
      appId: "1:499565676750:web:60aa159f30a4917fe6689f",
      measurementId: "G-2D8RFG5CVT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    /* ë¡œê·¸ì¸ìƒíƒœ, ë¡œê·¸ì¸í•œ ë‹‰ë„¤ì„, ID ì €ì¥ */
    var isLogin = false;
    var myName = '';
    var myID = '';

    function madeCookie() {
      document.cookie = `myID=${myID}; max-age=180; path=/`; //max-age ì´ˆë‹¨ìœ„ ì‹œê°„ ì§€ì† (ì¡°ì •í•˜ë©´ì„œ í…ŒìŠ¤íŠ¸ í•´ ì£¼ì„¸ìš”)
      document.cookie = `myName=${myName}; max-age=180; path=/`;

      //ì¿ í‚¤ í™•ì¸
      setTimeout(() => {
        const cookieID = document.cookie.split('; ').find(row => row.startsWith('myID='))?.split('=')[1];
        console.log("ì €ì¥ëœ myID:", cookieID);
      }, 200);
    }
    function cheakedCookie() {
      const cookieID = document.cookie
        .split('; ')
        .find(row => row.startsWith('myID='))
        ?.split('=')[1];

      const cookieName = document.cookie
        .split('; ')
        .find(row => row.startsWith('myName='))
        ?.split('=')[1];

      if (cookieName && cookieID) {
        // ë¡œê·¸ì¸ ìƒíƒœ
        myName = cookieName;
        myID = cookieID;
        isLogin = true;

        $('#loginName').css("display", "flex");
        $('#loginNameText').text(myName);
      } else {
        // ë¡œê·¸ì¸ ì•ˆ ëœ ìƒíƒœë§Œ ë¡œê·¸ì¸ UI ë³´ì—¬ì£¼ê¸°
        $('#floatingUI').show();
      }
    }
    cheakedCookie();

    /* ì—”í„° í‚¤ ì´ë²¤íŠ¸ ì²˜ë¦¬ */
    /* ì—”í„°ë¥¼ ëˆ„ë¥´ë©´ í´ë¦­ ì‘ë™ */
    $("#loginID, #loginPW").keypress(function (event) {
      if (event.which === 13) {
        $("#login").click();
        return false;
      }
    });
    $('#registerId, #registerPassword, #registerPasswordConfirm, #regName').keypress(function (event) {
      if (event.which === 13) {
        $("#register").click();
        return false;
      }
    });

    /* ë¡œê·¸ì¸ ë²„íŠ¼ */
    $("#login").click(async function () {
      const $loginIdInput = $("#loginID");
      const $loginPwInput = $("#loginPW");
      const $loginPopup = $("#loginPopup");
      const $floatingUI = $("#floatingUI");
      const $loginNameElement = $("#loginName");
      const $loginNameTextElement = $("#loginNameText");

      const inputID = $loginIdInput.val();
      const inputPW = $loginPwInput.val();

      try {
        const querySnapshot = await getDocs(collection(db, "info"));
        let loggedIn = false;

        querySnapshot.forEach((doc) => {
          const row = doc.data();
          const nickname = row['name'];
          const id = row['id'];
          const pw = row['pw'];

          if (inputID === id) {
            if (inputPW === pw) {
              // ë¡œê·¸ì¸ ì„±ê³µ ë¶ˆëŸ¬ì˜¨ ê°’ ì €ì¥
              myName = nickname;
              myID = id;
              isLogin = true;
              alert(`ì–´ì„œì˜¤ì„¸ìš” ${myName}ë‹˜`);

              madeCookie();

              // UI ë³€ê²½
              isLogin = true;
              $loginPopup.hide();
              $floatingUI.hide();
              $loginNameElement.css("display", "flex");
              $loginNameTextElement.text(myName);
              loggedIn = true;

              initInfo();
              return false; // ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ë©´ ì¢…ë£Œë£Œ
            } else {
              // ë¹„ë°€ë²ˆí˜¸ í‹€ë¦¼
              alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
              loggedIn = false;
              return false; // ì•„ì´ë””ê°€ ë§ìœ¼ë‚˜ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦¬ë©´ ì¢…ë£Œë£Œ
            }
          }
        });

        if (!loggedIn && querySnapshot.size > 0) { // ì•„ì´ë””ë¥¼ ì°¾ì§€ ëª»í–ˆê³ , ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°
          const foundId = querySnapshot.docs.some(doc => doc.data().id === inputID);
          if (!foundId) {
            alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.');
          }
        } else if (querySnapshot.empty) {
          alert('ë“±ë¡ëœ ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
        }

        return loggedIn;

      } catch (error) {
        console.error("ë¡œê·¸ì¸ ì˜¤ë¥˜:", error);
        alert('ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        return false;
      }
    });

    /* ê°€ì… ë²„íŠ¼ */
    $("#register").click(async function () {
      const regID = $('#registerId').val();
      const regPW = $('#registerPassword').val();
      const regPWCheck = $('#registerPasswordConfirm').val();
      const regName = $('#regName').val();
      let isIdTaken = false;
      let isNameTaken = false;

      if (!regID || /\s/.test(regID) || !regPW || !regName) { // ê³µë°± ì²´í¬
        alert('ê³µë°±ì„ í¬í•¨í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return false;
      }
      else if (regPW !== regPWCheck) { // ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ë€ì´ ë‹¤ë¥¼ ë•Œ
        alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
        return false;
      } else {  // ì…ë ¥ ì¡°ê±´ ì¶©ì¡±
        try {
          const querySnapshot = await getDocs(collection(db, "info"));

          querySnapshot.forEach((doc) => {
            const row = doc.data();
            if (row['id'] === regID) {
              alert('ì•„ì´ë””ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.');
              isIdTaken = true;
              return false; // ì•„ì´ë””ê°€ ì´ë¯¸ ì¡´ì¬í•  ê²½ìš° ì¢…ë£Œ
            }
            if (row['name'] === regName) {
              alert('ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì´ë¦„ì…ë‹ˆë‹¤.');
              isNameTaken = true;
              return false; // ë‹‰ë„¤ì„ì´ ì´ë¯¸ ì¡´ì¬í•  ê²½ìš° ì¢…ë£Œ
            }
          });
          // ê°€ì… ì¡°ê±´ ì¶©ì¡±
          if (!isIdTaken && !isNameTaken) {
            const newUser = {
              'id': regID,
              'pw': regPW,
              'name': regName
            };
            const addedDocRef = await addDoc(collection(db, "info"), newUser);
            alert(`í™˜ì˜í•©ë‹ˆë‹¤. ${regName}ë‹˜`);
            // íšŒì›ê°€ì… í›„ ìë™ë¡œê·¸ì¸
            myID = regID;
            myName = regName;
            isLogin = true;
            madeCookie();
            $('#registerPopup').hide();
            $('#floatingUI').hide();
            $('#loginName').css("display", "flex");
            $('#loginNameText').text(myName);
          }

        } catch (error) {
          console.error("Firebase íšŒì›ê°€ì… ì˜¤ë¥˜:", error);
          alert('íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      }
    });

    /*----------------------------------ì—¬ê¸°ê¹Œì§€ ë¶„í• ë¨---------------------------------------------*/
    // initinfo << ë¬¼ì–´ë³´ê³  ë„£ì–´ì•¼í•´ì„œ ë¶„í• í•œ ë‚´ìš©ì—ì„œ ëºìŒìŒ

    /* ë¡œê·¸ì•„ì›ƒ */
    $('#logoutButton').click(function () {
      // ì¿ í‚¤ ì‚­ì œ
      document.cookie = "myID=; max-age=0; path=/";
      document.cookie = "myName=; max-age=0; path=/";

      // ë³€ìˆ˜ ì´ˆê¸°í™”
      myID = '';
      myName = '';
      isLogin = false;

      // ë¡œê·¸ì¸ ì°½ ë‹¤ì‹œ ë³´ì—¬ì£¼ê¸°
      $('#floatingUI').show();

      // ë¡œê·¸ì¸ ìƒíƒœ í‘œì‹œ ìˆ¨ê¸°ê¸°
      $('#loginName').hide();

      // ì´ë¦„ í…ìŠ¤íŠ¸ ë¹„ìš°ê¸°
      $('#loginNameText').text('');
    });


    /* ëŒ“ê¸€ ì‘ì„± */
    const commentBox = document.querySelector(".comment__box");
    const commentInput = commentBox.querySelector("input");
    const commentBtn = commentBox.querySelector("button");

    const handleCommentClick = async () => {
      if (!isLogin) {
        alert('ë¡œê·¸ì¸ì„ í•˜ê³  ì‹œë„í•´ì£¼ì„¸ìš”.');
        return false;
      }

      const input = commentInput.value;
      if (input == "") return;

      saveCommentToFirebase(input);

      commentInput.value = "";
    };

    commentBtn.addEventListener("click", handleCommentClick);

    /* ëŒ“ê¸€ firebaseì— ì €ì¥ */
    const saveCommentToFirebase = async (commentText) => {
      const today = new Date();
      const ymd = `${today.getFullYear()}/${today.getMonth() + 1}/${today.getDate()} ${today.getHours()}:${today.getMinutes()}`;

      let doc = {
        'id': myID,
        'name': myName,
        'comment': commentText,
        'date': ymd,
        'dateObj': today 
      };

      try {
        // DBì— ì €ì¥ ì™„ë£Œ í›„, ë¦¬ì–¼ íƒ€ì„ìœ¼ë¡œ í™”ë©´ì— ë“±ë¡ 
        await addDoc(collection(db, "comments"), doc);
        realtimeUpdateComment(ymd, commentText);
        createPageBtn();
        initInfo();
      } catch (error) {
        console.error("Firebase ëŒ“ê¸€ ì €ì¥ ì˜¤ë¥˜:", error);
        alert('ëŒ“ê¸€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    };

    const handleCommentDeleteClick = async (event) => {
      const commentId = event.target.parentElement.dataset.id;
      const commentPanel = document.querySelector(".comment__panel");

      try {
        await deleteDoc(doc(db, "comments", commentId));
        alert("ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        initInfo();
      } catch (error) {
        console.error("ëŒ“ê¸€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜:", error);
      }

    }

    const initInfo = async () => {
      await showComments();
      showPageBtn();
      await preparePagination();

      const commentDeleteBtns = document.querySelectorAll(".commentDelete");
      commentDeleteBtns.forEach(deleteBtn => {
        deleteBtn.addEventListener("click", handleCommentDeleteClick);
      });
    }

    /* ìƒˆë¡œê³ ì¹¨í•˜ì§€ ì•Šê³  í™”ë©´ì— ë¦¬ì–¼íƒ€ì„ìœ¼ë¡œ ëŒ“ê¸€ ì—…ë°ì´íŠ¸ */
    const realtimeUpdateComment = (ymd, commentText) => {
      const comment = document.createElement("div");
      const commentPanel = document.querySelector(".comment__panel");

      const commentName = document.createElement("span");
      commentName.classList.add("comment__name");
      commentName.innerText = myName;

      const commentTextarea = document.createElement("span");
      commentTextarea.classList.add("comment__text");

      const todayDate = document.createElement("span");
      todayDate.classList.add("comment__date");
      todayDate.innerText = ymd;

      commentTextarea.innerText = commentText;
      comment.className = "comment";

      commentPanel.prepend(comment);
      comment.appendChild(commentName);
      comment.appendChild(commentTextarea);
      comment.appendChild(todayDate);
      commentPanel.classList.remove("hidden");
    }

    let pageSize = 5;
    let commentCursors = []; // ê° í˜ì´ì§€ì˜ ì‹œì‘ ë¬¸ì„œë¥¼ ì €ì¥

    async function preparePagination() {
      const q = query(collection(db, "comments"), orderBy("dateObj", "desc"));
      const snapshot = await getDocs(q);

      commentCursors = [];
      snapshot.docs.forEach((doc, i) => {
        if ((i+1) % pageSize === 1) {
          commentCursors.push(doc);
        }
      });
    }

    /* í˜ì´ì§€ ë¡œë”© ì‹œ, ëŒ“ê¸€ ë‚´ë¦¼ì°¨ìˆœ(ìµœì‹ ìˆœ)ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ë³´ì—¬ì£¼ê¸° */
    const showComments = async (pageIndex = 0) => {
      const commentPanel = document.querySelector(".comment__panel");
      commentPanel.innerHTML = '';

      // í˜ì´ì§€ 
      const commentDoc = checkPageIndexAndReturnComments(pageIndex);

      const snapshot = await getDocs(commentDoc);
      const comments = snapshot.docs.map((doc) => doc.data());

      snapshot.forEach((doc) => {
        const row = doc.data();
        const text = `
          <div class="comment__wrap" data-id=${doc.id}>
            <div class="comment">
              <span class="comment__name">${row.name}</span>
              <span class="comment__text">${row.comment}</span>
              <span class="comment__date">${row.date}</span>
            </div>
            ${row.id === myID ? '<button class="commentDelete">ì‚­ì œ</button>' : ''}
          </div>
        `;
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = text;
        const commentElement = tempDiv.firstElementChild;

        // append ì‹œ ì‹¤ì œ elementë¥¼ appendí•´ì•¼ ì´ë²¤íŠ¸ë„ ë¶™ìŠµë‹ˆë‹¤.
        document.querySelector(".comment__panel").appendChild(commentElement);

        // ì´ë²¤íŠ¸ ë°”ì¸ë”©
        const deleteButton = commentElement.querySelector(".commentDelete");
        if (deleteButton) {
          deleteButton.addEventListener("click", handleCommentDeleteClick);
        }
      });
    };

    const checkPageIndexAndReturnComments = (pageIndex) => {
      let q;
  
      // ì²« í˜ì´ì§€
      if (pageIndex === 0) {
        q = query(
          collection(db, "comments"),
          orderBy("dateObj", "desc"),
          limit(pageSize)
        );
      } else {
        const startDoc = commentCursors[pageIndex];
        if (!startDoc) return console.warn("ì—†ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.");
        q = query(
          collection(db, "comments"),
          orderBy("dateObj", "desc"),
          startAt(startDoc),
          limit(pageSize)
        );
      }
      return q;
    }

    async function createPageBtn() {
      // "comments" ì»¬ë ‰ì…˜ ì°¸ì¡°
      const colRef = collection(getFirestore(), "comments");
  
      const snapshot = await getCountFromServer(colRef); // ì´ ë¬¸ì„œ ìˆ˜ ê°€ì ¸ì˜¤ê¸°
      const docCount = snapshot.data().count; // ë¬¸ì„œ ìˆ˜ í™•ì¸
  
      const pageLink = document.querySelector(".pageLink");
      // ì´ ë¬¸ì„œ ìˆ˜ê°€ 5ë¡œ ë‚˜ëˆˆ ë‚˜ë¨¸ì§€ê°€ 1ì¼ ê²½ìš° ë²„íŠ¼ ìƒì„±
      if (docCount % 5 === 1) {
          // ë²„íŠ¼ì´ ì¶”ê°€ë  ì»¨í…Œì´ë„ˆ ì„ íƒ
          const existingButtons = document.querySelectorAll(".pageBtn").length;
          // ìƒˆë¡œìš´ ë²„íŠ¼ ìƒì„±
          const newButton = document.createElement("button");
          newButton.innerText = `(${existingButtons + 1})`; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì„¤ì • (ì˜ˆ: 3, 4 ë“± ìˆœì°¨ì ìœ¼ë¡œ ì¶”ê°€)
          newButton.value = existingButtons;
          newButton.classList.add("pageBtn"); // ë²„íŠ¼ í´ë˜ìŠ¤ ì¶”ê°€
          pageLink.appendChild(newButton); // .pageLinkì— ë²„íŠ¼ ì¶”ê°€
          // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
          newButton.addEventListener("click", () => {
            const pageIndex = parseInt(newButton.value);
            showComments(pageIndex);
          });
      } else {
        return;
      }
    }

    const showPageBtn = async () => {
      const colRef = collection(getFirestore(), "comments");
  
      const snapshot = await getCountFromServer(colRef); // ì´ ë¬¸ì„œ ìˆ˜ ê°€ì ¸ì˜¤ê¸°
      let docCount = snapshot.data().count; 
  
      const pageLink = document.querySelector(".pageLink");
      pageLink.innerHTML = "";
      while(docCount > 0) {
        const existingButtons = document.querySelectorAll(".pageBtn").length;
          
        // ìƒˆë¡œìš´ ë²„íŠ¼ ìƒì„±
        const newButton = document.createElement("button");
        newButton.innerText = `(${existingButtons + 1})`; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì„¤ì • (ì˜ˆ: 3, 4 ë“± ìˆœì°¨ì ìœ¼ë¡œ ì¶”ê°€)
        newButton.value = existingButtons;
        newButton.classList.add("pageBtn"); // ë²„íŠ¼ í´ë˜ìŠ¤ ì¶”ê°€
        pageLink.appendChild(newButton); // .pageLinkì— ë²„íŠ¼ ì¶”ê°€
        // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
        newButton.addEventListener("click", () => {
          const pageIndex = parseInt(newButton.value);
          showComments(pageIndex);
          }
        );
        docCount-=5;
        }
    }

    // í˜¸ì¶œ: ì²« ì‹œì‘í•  ë•Œ í•œ ë²ˆë§Œ ì‹¤í–‰
    showPageBtn();
    initInfo();
  </script>


</html>
