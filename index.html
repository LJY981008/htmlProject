<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weekly Me</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
  <link rel="stylesheet" href="HTML_Project/css/card.css" />
  <link rel="stylesheet" href="HTML_Project/css/category.css" />
  <link rel="stylesheet" href="HTML_Project/css/KYG_comment.css" />
  <link rel="stylesheet" href="HTML_Project/css/login.css" />
  <link rel="stylesheet" href="HTML_Project/css/sideUI.css" />
  <style>
    /*ë°°ê²½ì„¤ì •ì •*/
    body {
      height: 5000px;
      background-image: url('HTML_Project/picture/mainBackground.jpeg');
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;
      background-blend-mode: overlay;
      background-color: rgba(0, 0, 255, 0.2);
    }

    /*ì¹´í…Œê³ ë¦¬ í°íŠ¸*/
    .nav-link {
      font-size: 3rem;
      color: white;
    }

    /*ë‚´ë¹„ê²Œì´ì…˜ ìƒë‹¨ê³ ì •*/
    .fixed-nav {
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 100;
    }

    /*íŒ€ì†Œê°œ ë°°ê²½ê²½*/
    .intro {
      margin-top: 200px;
      padding-top: 50px;
      padding-bottom: 50px;
      background-color: rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-right: 100px;
      padding-left: 50px;
    }

    /*íŒ€ì†Œê°œ í…ìŠ¤íŠ¸*/
    .introText {
      align-items: center;
    }

    /*ì´ë¯¸ì§€ í¬ê¸° ë° ì˜¤ë¥¸ìª½ì •ë ¬ë ¬*/
    .intro img {
      width: 600px;
      height: 500px;
      margin-left: auto;
    }

    /*í…ìŠ¤íŠ¸ í°íŠ¸íŠ¸*/
    .intro p {
      color: white;
      /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì¶”ê°€ */
      font-size: 2rem;
      /* í…ìŠ¤íŠ¸ í¬ê¸° ì¶”ê°€ */
    }

    /*íŒ€ì› ì¹´ë“œ ë°°ê²½*/
    .team {
      margin-top: 600px;
      padding-top: 50px;
      padding-bottom: 50px;
      background-color: rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-right: 100px;
      padding-left: 50px;
    }
  </style>
</head>

<body>
  <!--hrefì— í´ë¦­ì‹œ ì´ë™ ìœ„ì¹˜ ì¶”ê°€ -ì´í˜„í•˜-->
  <ul class="nav justify-content-center fixed-nav">
    <li class="nav-item">
      <a class="nav-link" aria-current="page" href="#teamIntro">íŒ€ ì†Œê°œ</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#teamMember">íŒ€ì›ë“¤</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#homeComment">ë°©ëª…ë¡</a>
    </li>
    <div class="loginName" id="loginName">
      <p id="loginNameText">aaa</p>
    </div>
  </ul>

  <!--id ì¶”ê°€ ë° íŒ€ ì†Œê°œ ë³€ê²½ -ì´í˜„í•˜-->
  <div class="intro" id="teamIntro">
    <div class="introText">
      <h1><span class="shine-text">Weekly Me</span> ğŸ‘‘</h1>
      <p>â€œì´ë²ˆ ì£¼ì˜ ì£¼ì¸ê³µì€ ëˆ„êµ¬?â€ <br>
        ë°”ë¡œ ì €í¬ Weekly Me, 1ì¡°ì…ë‹ˆë‹¤! <br>
      </p>
      <p style="font-size: 1.5rem;">ì´ë¦„ì²˜ëŸ¼ ì´ë²ˆ ì£¼ì˜ ì£¼ì¸ê³µ(ì¼ì£¼ì¸ê³µ)ì€ ë°”ë¡œ ìš°ë¦¬ì´ê³ ,<br>
        ë§¤ì£¼ ë” ì„±ì¥í•˜ëŠ” ë‚˜ë¥¼ ë§Œë“¤ì–´ê°€ìëŠ” ì˜ë¯¸ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.<br>
        ì§§ì§€ë§Œ ê°ìì˜ ê°•ì ì„ ì‚´ë ¤ í˜‘ë ¥í•˜ê³ , ì¦ê¸°ë©´ì„œ ì„±ì¥í•˜ëŠ” íŒ€ì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤!ğŸ”¥
      </p>
    </div>
    <img src="HTML_Project\picture\teamImg.jpg">
  </div>

  <!--ì¹´ë“œ ìš°ìƒˆë¹›-->
  <div class="team" id="teamMember">
    <div class="row row-cols-1 row-cols-md-3 g-4">
      <div class="col">
        <div class="card" id="card_LJY">
          <img src="HTML_Project/picture/LJY/LJY_Picture.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title"><b>ì´ì¤€ì˜</b></h5>
            <p class="card-text">íŒ€ì¥</p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card" id="card_hyeonha">
          <img src="HTML_Project/picture/LHH/LHH_image.jpeg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title"><b>ì´í˜„í•˜</b></h5>
            <p class="card-text">íŒ€ì›</p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card" id="card_WSV">
          <img src="HTML_Project/picture/WSV/WSV_p.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title"><b>ìš°ìƒˆë¹›</b></h5>
            <p class="card-text">íŒ€ì›</p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card" id="card_CHE">
          <img src="HTML_Project/picture/CHE/CHE_face.jpg" class="card-img-top">
          <div class="card-body">
            <h5 class="card-title"><b>ìµœê²½ì§„</b></h5>
            <p class="card-text">íŒ€ì›</p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card" id="card_HJ">
          <img src="HTML_Project/picture/HJ/YHJ.png.png" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title"><b>ìœ¤í¬ì¤€</b></h5>
            <p class="card-text">íŒ€ì›</p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card" id="card_KYG">
          <img src="HTML_Project/picture/KYG/KYG_face.png" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title"><b>ê¹€ìš©ì¤€</b></h5>
            <p class="card-text">íŒ€ì›</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--ëŒ“ê¸€ ìµœê²½ì§„-->
  <div class="comment__box" id="homeComment">
    <h1>ë°©ëª…ë¡</h1>
    <div class="input-group">
      <input type="text" class="form-control" placeholder="Recipient's username" aria-label="Recipient's username"
        aria-describedby="button-addon2" id="homeCommentText" />
      <button type="button" class="btn btn-primary" id="postingComment">ê²Œì‹œ</button>
    </div>
  </div>
  <div class="comment__panel hidden"></div>


  <!--ë¡œê·¸ì¸íšŒì›ê°€ì…UI-->
  <div class="floating-ui" id="floatingUI">
    <button id="loginButton">ë¡œê·¸ì¸</button>
    <button id="registerButton">íšŒì›ê°€ì…</button>
  </div>

  <!--ë¡œê·¸ì¸ íŒì—…-->
  <div id="loginPopup" class="popup">
    <div class="popup-content">
      <span class="close-button" id="closeLoginPopup">&times;</span>
      <h2>ë¡œê·¸ì¸</h2>
      <form>
        <div class="mb-3">
          <label for="loginID" class="form-label">ì•„ì´ë””</label>
          <input type="text" class="form-control" id="loginID" aria-describedby="emailHelp">
        </div>
        <div class="mb-3">
          <label for="loginPW" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" class="form-control" id="loginPW">
        </div>
        <button type="button" class="btn btn-primary" id="login">ë¡œê·¸ì¸</button>
      </form>
    </div>
  </div>

  <!--íšŒì›ê°€ì… íŒì—…-->
  <div id="registerPopup" class="popup">
    <div class="popup-content">
      <span class="close-button" id="closeRegisterPopup">&times;</span>
      <h2>íšŒì›ê°€ì…</h2>
      <form>
        <div class="mb-3">
          <label for="regName" class="form-label">ë‹‰ë„¤ì„</label>
          <input type="text" class="form-control" id="regName">
        </div>
        <div class="mb-3">
          <label for="registerId" class="form-label">ì•„ì´ë””</label>
          <input type="text" class="form-control" id="registerId">
        </div>
        <div class="mb-3">
          <label for="registerPassword" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" class="form-control" id="registerPassword">
        </div>
        <div class="mb-3">
          <label for="registerPasswordConfirm" class="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <input type="password" class="form-control" id="registerPasswordConfirm">
        </div>
        <button type="button" class="btn btn-success" id="register">íšŒì›ê°€ì…</button>
      </form>
    </div>
  </div>
  </div>

  <script src="HTML_Project/javaScript/card.js"></script>
  <script src="HTML_Project/javaScript/register_login.js"></script>
  <script type="module">
    // Firebase SDK ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyDIYr5xaD01ndxx0anOhCgoKRHT6rAHWnc",
      authDomain: "weeklyme-4e92d.firebaseapp.com",
      projectId: "weeklyme-4e92d",
      storageBucket: "weeklyme-4e92d.firebasestorage.app",
      messagingSenderId: "499565676750",
      appId: "1:499565676750:web:60aa159f30a4917fe6689f",
      measurementId: "G-2D8RFG5CVT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    var isLogin = false;
    var name = '';
    var myid = '';
    var pattern = /\s/g;

    /* ë¡œê·¸ì¸ ë²„íŠ¼ */
    $("#login").click(async function () {
      let docs = await getDocs(collection(db, "info"));
      docs.forEach((doc) => {
        let row = doc.data();
        let nickname = row['name'];
        let id = row['id'];
        let pw = row['pw'];

        let inputID = $('#loginID').val();
        let inputPW = $('#loginPW').val();

        if (inputID == id) {
          if (inputPW == pw) {
            /* ë¡œê·¸ì¸ ì„±ê³µ */
            name = nickname;
            myid = id;
            isLogin = true;
            alert('ì–´ì„œì˜¤ì„¸ìš”' + name + 'ë‹˜');
            /* uië³€ê²½ í•„ìš” */
            isLogin = true;
            $('#loginPopup').css("display", "none");
            $('#floatingUI').css("display", "none");
            $('#loginName').css("display", "flex");
            $('#loginNameText').text(name);
            return true;
          }
          else {
            /* ë¹„ë°€ë²ˆí˜¸ í‹€ë¦¼ */
            alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
            return false;
          }
        }
      });
    })

    /* ê°€ì… ë²„íŠ¼  */
    $("#register").click(async function () {
      let regID = $('#registerId').val();
      let regPW = $('#registerPassword').val();
      let regPWCheck = $('#registerPasswordConfirm').val();
      let regName = $('#regName').val();
      let flag = false;

      if (regPW != regPWCheck) {
        alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
        return false;
      }
      else if (!regID || pattern.test(regID)) { // ìˆ˜ì •ëœ ë¶€ë¶„
        alert('ì•„ì´ë””ì— ê³µë°±ì„ í¬í•¨í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return false;
      }
      else {
        let docs = await getDocs(collection(db, "info"));
        docs.forEach((doc) => {
          let row = doc.data();
          let id = row['id'];
          if (id == regID) {
            alert('ì•„ì´ë””ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.');
            flag = true;
            return false;
          }
          if (regName == row['name']) {
            alert('ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì´ë¦„ì…ë‹ˆë‹¤.');
            flag = true;
            return false;
          }
        });

        if (!flag) {
          let doc = {
            'id': regID,
            'pw': regPW,
            'name': regName
          };
          try {
            const addedDocRef = await addDoc(collection(db, "info"), doc);
            alert('í™˜ì˜í•©ë‹ˆë‹¤. ' + regName + 'ë‹˜');
            myid = regID;
            name = regName;
            isLogin = true;
            $('#registerPopup').css("display", "none");
            $('#floatingUI').css("display", "none");
            $('#loginName').css("display", "flex");
            $('#loginNameText').text(name);
          } catch (error) {
            console.error("Firebase íšŒì›ê°€ì… ì˜¤ë¥˜:", error);
            alert('íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          }
        }
      }
    });

    /* ëŒ“ê¸€ ì‘ì„± */
    const commentBox = document.querySelector(".comment__box");
    const commentInput = commentBox.querySelector("input");
    const commentBtn = commentBox.querySelector("button");

    // Firebase ì €ì¥ í•¨ìˆ˜ (ë‘ ë²ˆì§¸ JS íŒŒì¼ì˜ ë¡œì§ì„ ê°€ì ¸ì˜´)
    const saveCommentToFirebase = async (commentText) => {
      if (!isLogin) {
        alert('ë¡œê·¸ì¸ì„ í•˜ê³  ì‹œë„í•´ì£¼ì„¸ìš”.');
        return false;
      }
      let today = new Date();
      let year = today.getFullYear();
      let month = today.getMonth();
      let date = today.getDate();
      let ymd = year + '/' + month + '/' + date;
      console.log("Firebaseì— ì €ì¥í•  ëŒ“ê¸€:", commentText);
      let doc = {
        'id': myid,
        'name': name,
        'comment': commentText,
        'date': ymd
      };
      try {
        await addDoc(collection(db, "comments"), doc);
        console.log('Firebaseì— ëŒ“ê¸€ ì €ì¥ ì™„ë£Œ');
        // alert('ì‘ì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'); // Firebase ì €ì¥ì´ ì™„ë£Œë˜ë©´ ì•Œë¦¼ (ì„ íƒ ì‚¬í•­)
      } catch (error) {
        console.error("Firebase ëŒ“ê¸€ ì €ì¥ ì˜¤ë¥˜:", error);
        alert('ëŒ“ê¸€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    };
    const addComment = (input) => {
      if (input == "") return;
      const comment = document.createElement("div");
      const commentPanel = document.querySelector(".comment__panel");

      const commentName = document.createElement("span");
      commentName.classList.add("comment__name");
      commentName.innerText = "ê¹€ì•„ë¬´ê°œ";

      const commentText = document.createElement("span");
      commentText.classList.add("comment__text");

      const today = new Date();
      const todayDate = document.createElement("span");
      todayDate.classList.add("comment__date");
      todayDate.innerText = `ë°©ë¬¸ ë‚ ì§œ : ${today.getFullYear()}ë…„ ${today.getMonth() + 1}ì›” ${today.getDate()}ì¼ ${today.getHours()}ì‹œ ${today.getMinutes()}ë¶„`

      commentText.innerText = input;
      comment.className = "comment";

      commentPanel.appendChild(comment);
      comment.appendChild(commentName);
      comment.appendChild(commentText);
      comment.appendChild(todayDate);
      commentPanel.classList.remove("hidden");

      // ëŒ“ê¸€ì´ í™”ë©´ì— ì¶”ê°€ëœ í›„ Firebase ì €ì¥ í•¨ìˆ˜ í˜¸ì¶œ
      saveCommentToFirebase(input);
    };

    const handleCommentClick = () => {
      const input = commentInput.value;
      addComment(input);
      commentInput.value = "";
    };

    commentBtn.addEventListener("click", handleCommentClick);

    /* ëŒ“ê¸€ ê°±ì‹  */
    let commentsDocs = await getDocs(collection(db, "comments"));
    commentsDocs.forEach((doc) => {
      let row = doc.data();
      let name = row['name'];
      let date = row['date'];
      let comment = row['comment'];

      /* ëŒ“ê¸€ htmlì½”ë“œ */
      let text = ``;

      $('#commentArea').append(text);
    })
  </script>

</html>